---
title: "리팩터링 02"
date: 2020-06-26 23:59:00
categories: review
tags:
  - 리팩터링
  - 개발자
  - 책리뷰
---

리팩터링 : 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법

### 리팩터링 하는 이유

- 리팩터링하면 소프트웨어 설계가 좋아진다.
    - 아키텍처를 이해하지 못한채 단기 목표만을 위해 코드를 수정하다면 기반 구조가 무너지기 쉽다. 코드만으로 설계를 파악하기 어려워질 수록 설계를 유지하기 어려워지고 설계가 부패되는 속도는 더욱 빨라진다. 중복 코드를 제거하면 이해해야 할 코드량이 줄어들고 모든 코드가 언제나 고유한 일을 수행함을 보장할 수 있다.
- 리팩터링하면 소프트웨어를 이해하기 쉬워진다.
    - 리팩터링은 코드가 더 잘 읽히게 도와준다. 잘 동작하지만 이상적인 구조는 아닌 코드가 있다면 잠깐 시간을 내서 리팩토링하자. 코드의 목적이 더 잘 드러나고 내 의도를 명확하게 전달할 수 있도록 개선할 수 있다.
- 래퍽터링하면 버그를 쉽게 찾을 수 있다.
    - 리팩터링하면 코드가 하는 일을 깊이 파악하게 되면서 새로 깨달은 것을 곧바로 코드에 반영할 수 있다.
- 리팩터링하면 프로그래밍 속도를 높일 수 있다.
    - 새로운 기능을 추가할수록 기존 코드에 잘 녹여낼 방법을 찾는 데 드는 시간이 늘어나기 때문에 시간이 오래걸린다. 이는 소프트웨어 내부 품질에 있다. 내부 설계가 잘 된 소프트웨어는 새로운 기능을 추가할 지점과 어떻게 고칠지를 쉽게 찾을 수 있다. 모듈화가 잘 되어 있으면 전체 코드베이스 중 작은 일부만 이해하면 된다. 코드가 명확하면 버그를 만들 가능성도 줄고 버그를 만들더라도 디버깅하기가 훨씬 쉽다.

### 언제 리팩터링해야할까?

1. 처음에는 그냥한다.
2. 비슷한 일을 두번째로 하게되면 일단 계속 진행
3. 비슷한 일을 세번째하게되면 리팩터링한다.
- 기능을 쉽게 추가하게 만들기
    - 리팩터링하기 가장 좋은 시점은 코드에 기능을 새로 추가하기 직전이다. 구조를 살짝 바꾸면 다른 작업을 하기가 쉬워질만한 부분을 찾는다.
- 코드를 이해하기 쉽게 만들기
    - 코드의 의도가 더 명확하게 드러나도록 리팩터링할 여지는 없는지 찾아본다.
- 쓰레기 줍기 리팩터링
    - 로직이 쓸데없이 복잡하거나, 매개변수화한 함수 하나면 될일을 거의 똑같은 함수 여러개로 작성해놓는 비효율적으로 처리하는 경우, 수정할 수 있는 것은 즉시 고치고, 시간이 걸리는 일은  짧은 메모만 남긴다음, 하던일을 끝내고 나서 처리한다.
- 계획된 리팩터링과 수시로 하는 리팩터링
    - 리팩터링은 프로그래밍과 구분되는 별개의 활동이 아니다.
- 오래 걸리는 리팩터링
    - 예를 들어 라이브러리르 교체할때는 기존과 새것 모두 포용하는 추상 인터페이스부터 마련한다. 기존 코드가 이 추상 인터페이스를 호출하도록 만들고 나면 라이브러리르 쉽게 교체할 수 있다.
- 코드 리뷰에 리팩토링 활용하기
- 관리자에게는 뭐라고 말해야 할까?
    - 기술을 모르는 상당수의 관리자와 고객은 코드의 건강 상태가 생산성에 미치는 영향을 모른다. 프로 개발자의 역할을 효과적인 소프트웨어를 최대한 빨리 만드는 것이다. 리팩터링하면 소프트웨어를 빠르게 만드는데 효과적이다.
- 리팩터링하지 말아야 할 때
    - 지저분한 코드를 발견해도 굳이 수정할 필요가 없다면, 외부api 다루듯 호출해서 쓰는 코드라면, 처음부터 작성하는 것이 쉬울때도 있다.

### 리팩터링 시 고려할 문제

- 새 가능 개발 속도 저하
    - 리팩터링의 궁극적인 목적은 개발 속도를 높여서 더 적은 노력으로 더 많은 가치를 창출하는 것이다.
    - 상황에 맞게 조율해야 한다. 정량화하기는 어렵지만 리팩터링을 하면 변경하기 쉬운 코드는 주저하지 않고 한다.
- 코드 소유권
- 브랜치
    - 브랜치를 자주 통합할 수 있다면 문제가 발생할 가능성을 크게 줄일 수 있다.
- 테스팅
    - 오류를 재빨리 잡기 위해서 코드의 다양한 측며을 검사하는 테스트가 필요하다.
- 레거시코드
    - 대체로 복잡하고 테스트도 제대로 갖춰지지 않은 것이 많다. 서로 관련된 부분끼리 나눠서 하나씩 공략하여 테스트코드를 작성하며 리팩터링한다.
- 데이터베이스
    - 데이터베이스 리팩터링은 프로덕션 환경에서 여러 단계로 나눠서 릴리스하는 것이 대체로 좋다. 필드이름을 바꿀 때 첫 번째 커밋에서는 새로운 데이터베이스 필드를 추가만 하고 사용하지는 않는다. 그런 다음 기존 필드와 새 플드를 사용하는 버전으로 조금씩 교체한다. 이 과정에서 발생하는 버그도 해결하면서 클라이언트 교체작업을 끝내면 필요가 없어진 예전 필드를 삭제한다. : 병렬 수정(parallel change)

### 리팩터링, 아키텍처, 애그니(YAGNI)

- 리팩터링을 활용하면, 앞으로 어느부분에 유연성이 필요하고 어떻게 해야 그 변화에 잘 대응할 수 있을 지 추측하지 않고 현재까지 파악된 요구사항만을 해결하는 소프트웨어를 구축한다.
- YAGNI : you aren't goring to need it : 당장 필요한 기능만으로 최대한 간결하게 만들어라.

### 리팩터링과 소프트웨어 개발 프로세스

- 테스트 주도 개발 (TDD) : 자가 테스트코드 + 리팩터링